#!/bin/bash
# ImageNode launcher script - {{ imagenode_accelerator_type }} configuration
# Generated by SentinelCam Ansible for {{ inventory_hostname }}

{% if imagenode_accelerator_type == 'ncs2' %}
# Setup OpenVino environment for NCS2 (LEGACY - deprecated)
# Note: NCS2/OpenVINO is only supported on legacy Raspberry Pi OS
# New deployments should use Coral EdgeTPU accelerator
source {{ openvino_setup_script | default('/home/' + sentinelcam_user + '/openvino/bin/setupvars.sh') }}
# Use OpenVINO venv for legacy NCS2 nodes
source {{ imagenode_venv_path_openvino | default('/home/' + sentinelcam_user + '/.virtualenvs/openvino') }}/bin/activate
{% elif imagenode_accelerator_type == 'coral' %}
# Coral EdgeTPU accelerator (recommended for new deployments)
# Packages: libedgetpu, pycoral, tflite_runtime from feranick builds
source {{ imagenode_venv_path }}/bin/activate
{% else %}
# CPU-only inference (no hardware acceleration)
source {{ imagenode_venv_path }}/bin/activate
{% endif %}

# Execute ImageNode with unbuffered output
exec python -u {{ imagenode_install_path }}/imagenode/imagenode.py
