# WireGuard Configuration File
# Managed by wg-quick
# Generated by Ansible

[Interface]
PrivateKey = {{ vault_wireguard_private_key }}
Address = {{ bastion_wireguard.address_ipv4 }}, {{ bastion_wireguard.address_ipv6 }}
MTU = {{ bastion_wireguard.mtu }}

# PostUp: Add route to reach WireGuard endpoint via eth0
PostUp = ip route add {{ vault_wireguard_endpoint }}/32 via {{ bastion_interfaces.external.gateway }} dev {{ bastion_interfaces.external.name }}

# PreDown: Remove the endpoint route
PreDown = ip route del {{ vault_wireguard_endpoint }}/32 via {{ bastion_interfaces.external.gateway }} dev {{ bastion_interfaces.external.name }}

[Peer]
PublicKey = {{ vault_wireguard_peer_public_key }}
Endpoint = {{ vault_wireguard_endpoint }}:{{ vault_wireguard_port }}
AllowedIPs = {{ bastion_wireguard.peer.allowed_ips }}
PersistentKeepalive = {{ bastion_wireguard.peer.persistent_keepalive }}
