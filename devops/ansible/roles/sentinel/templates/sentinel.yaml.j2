%YAML 1.0
---
# Settings file sentinel.yaml - Generated by SentinelCam Ansible
control_port: {{ sentinelcam_ports.sentinel_control }}
logging_port: {{ sentinelcam_ports.sentinel_logging }}
default_pump: tcp://{{ primary_datasink }}:{{ sentinelcam_ports.datapump_control }}
socket_dir: {{ sentinel_socket_dir }}

# For ring buffer allocations, any potential image size must
# be known in advance. Each of the task_engines need a set of 
# ring buffers. Parameters are ((width, height), buffer_length)
ring_buffer_models:
{% for model_name, model_config in sentinel_ring_buffer_models.items() %}
    {{ model_name }}:
{% for size_name, size_config in model_config.items() %}
        {{ size_name }}: (({{ size_config.size[0] }}, {{ size_config.size[1] }}), {{ size_config.buffer_length }})
{% endfor %}
{% endfor %}

# Task engines configuration
# Probably no more than three of these on a Raspberry Pi 4B?
# Ideally, one would have a dedicated co-processor for real-time 
# response, and others for background maintenance tasks requiring
# only low to moderate CPU resources. Scheduling batch workloads 
# into idle time periods is helpful. 
task_engines:
{% for engine_name, engine_config in sentinel_task_engines.items() %}
    {{ engine_name }}: 
        classes: {{ engine_config.classes }}
        ring_buffers: {{ engine_config.ring_buffers }}
        accelerator: {{ engine_config.accelerator }}
{% endfor %}
    
# The list of currently available tasks. These can be configured
# by job class to have an affinity with a particular task engine.
# Each task must have a matching class definition in the TaskFactory
# or include an alias reference to the underlying task.
task_list:
{% for task_name, task_config in sentinel_tasks.items() %}
    {{ task_name }}:
        config: {{ sentinel_install_path }}/tasks/{{ task_config.config_file }}
{% if task_config.chain is defined %}
        chain: {{ task_config.chain }}
{% endif %}
        class: {{ task_config.class }}
{% if task_config.trk_type is defined %}
        trk_type: {{ task_config.trk_type }}
{% endif %}
{% if task_config.ringctrl is defined %}
        ringctrl: {{ task_config.ringctrl }}
{% endif %}
{% if task_config.alias is defined %}
        alias: {{ task_config.alias }}
{% endif %}
{% endfor %}

# Configure logging publication over 0MQ
logconfig:
    version: 1
    handlers:
        zmq:
            class: zmq.log.handlers.PUBHandler
            interface_or_socket: tcp://*:{{ sentinelcam_ports.sentinel_logging }}
            root_topic: Sentinel
            level: {{ 'DEBUG' if debug_mode else 'INFO' }}
    root:
        handlers: [zmq]
        level: {{ 'DEBUG' if debug_mode else 'INFO' }}
