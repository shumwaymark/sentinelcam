---
# Default variables for SentinelCam Sentinel Role
# See group_vars/all/sentinelcam_ports.yaml for port definitions
# See group_vars/all/sentinelcam_standards.yaml for path standards

# Sentinel configuration
sentinel_service: sentinel
sentinel_config_file: sentinel.yaml
sentinel_install_path: "/home/{{ sentinelcam_user }}/sentinel"
sentinel_config_path: "/home/{{ sentinelcam_user }}/sentinel.yaml"

# Hardware Accelerator Configuration
# -----------------------------------
# Supported accelerators:
#   - coral: Google Coral USB Accelerator
#   - cpu: CPU-only inference (slower, no special hardware needed)
#   - ncs2: Intel Neural Compute Stick 2 (deprecated, hardware no longer supported by OpenVINO)
sentinel_accelerator_type: coral

# Virtual environment path
# For Coral/CPU: use standard SentinelCam venv
# For NCS2 (legacy): use OpenVINO venv
sentinel_venv_path: "{{ sentinelcam_venv_opencv }}"

# OpenVINO environment (LEGACY - only for nodes with an NCS2 accelerator)
openvino_setup_script: "/home/{{ sentinelcam_user }}/openvino/bin/setupvars.sh"
sentinel_venv_path_openvino: "/home/{{ sentinelcam_user }}/.virtualenvs/openvino"

# IPC socket directory (absolute path)
sentinel_socket_dir: "{{ sentinel_install_path }}/sockets"

# Model paths configuration (absolute path)
sentinel_models_path: "{{ sentinel_install_path }}/models"

# Model version overrides (optional per-host customization)
# Override specific model versions in host_vars if testing new models
# Example: model_version_overrides: { face_recognition: "2025-12-01" }
model_version_overrides: {}

# Coral package provisioning flag
# Set to true to install Coral packages during sentinel role provisioning
# Packages are sourced from model registry on primary_datasink
sentinel_install_coral_packages: "{{ sentinel_accelerator_type == 'coral' }}"

# Face Detection Model Selection
# --------------------------------
# Supported EdgeTPU face detection models:
#   - ssd_mobilenet: SSD MobileNet V2 (default, works with get_objects())
#   - blazeface: BlazeFace from MediaPipe (recommended, fewer false positives)
#     - Uses full_range variant (0-5m) - suitable for surveillance
#     - short_range variant (0-2m) is for mobile/selfie use cases
#
# Model selection only applies when sentinel_accelerator_type == 'coral'
# CPU and NCS2 modes always use OpenCV DNN (res10_300x300_ssd)
sentinel_face_detection_model: ssd_mobilenet  # [ssd_mobilenet, blazeface]

# BlazeFace variant selection (when sentinel_face_detection_model == 'blazeface')
#   - full: Full range (0-5m) - RECOMMENDED for surveillance cameras
#   - short: Short range (0-2m) - for mobile/selfie applications
sentinel_blazeface_variant: full  # [full, short]

# Face Detection Model Paths (versioned from registry)
face_detection_base_path: "{{ sentinel_models_path }}/face_detection/{{ model_version_overrides.face_detection | default(sentinelcam_models.face_detection.current_version) }}"
face_detection_edgetpu_path: "{{ sentinel_models_path }}/face_detection_edgetpu/{{ model_version_overrides.face_detection_edgetpu | default(sentinelcam_models.face_detection_edgetpu.current_version) }}"
face_detection_blazeface_path: "{{ sentinel_models_path }}/face_detection_blazeface/{{ model_version_overrides.face_detection_blazeface | default(sentinelcam_models.face_detection_blazeface.current_version) }}"

# Face Detection Model Files
face_detection_prototxt: "{{ face_detection_base_path }}/deploy.prototxt"
face_detection_caffemodel: "{{ face_detection_base_path }}/res10_300x300_ssd_iter_140000.caffemodel"
face_detection_ssd_mobilenet_model: "{{ face_detection_edgetpu_path }}/ssd_mobilenet_v2_face_quant_postprocess_edgetpu.tflite"
face_detection_blazeface_short_model: "{{ face_detection_blazeface_path }}/face_detection_short_range_edgetpu.tflite"
face_detection_blazeface_full_model: "{{ face_detection_blazeface_path }}/face_detection_full_range_edgetpu.tflite"

# Face Detection Confidence Thresholds (model-specific defaults)
# Can be overridden in host_vars per-host
face_detection_confidence:
  cpu: 0.5
  ncs2: 0.5
  ssd_mobilenet: 0.5
  blazeface: 0.5  # Full range works well at 0.5

# Debug mode flag
debug_mode: false

# Ring buffer models - image sizes and buffer lengths
sentinel_ring_buffer_models:
  default:
    vga:
      size: [640, 480]
      buffer_length: 5
    sd:
      size: [640, 360]
      buffer_length: 5

# Task engines configuration
sentinel_task_engines:
  Alpha:
    classes: [1]
    ring_buffers: default
    accelerator: "{{ sentinel_accelerator_type }}"
  Bravo1:
    classes: [2]
    ring_buffers: default
    accelerator: cpu
  Bravo2:
    classes: [2, 3]
    ring_buffers: default
    accelerator: cpu

# Available tasks configuration
sentinel_tasks:
  MobileNetSSD_allFrames:
    config_file: MobileNetSSD_allFrames.yaml
    chain: GetFaces
    class: 1
  GetFaces:
    config_file: GetFaces.yaml
    chain: FaceRecon
    class: 1
    trk_type: obj
    ringctrl: full
  FaceRecon:
    config_file: FaceRecon.yaml
    class: 2
    trk_type: fd1
    ringctrl: trk
  FaceSweep:
    config_file: FaceSweep.yaml
    class: 2
  FaceDataUpdate:
    config_file: FaceDataUpdate.yaml
    class: 2
  GetFaces2:
    alias: GetFaces
    config_file: GetFaces.yaml
    chain: FaceRecon
    class: 1
  DailyCleanup:
    config_file: DailyCleanup.yaml
    class: 3
  MeasureRingLatency:
    config_file: MeasureRingLatency.yaml
    class: 1
